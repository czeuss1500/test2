local library = {}
local services = setmetatable({}, {
    __index = function(self, key)
        local service = cloneref(game:GetService(key))
        rawset(self, key, service)
        return service
    end
})

local players = services.Players
local userinputservice = services.UserInputService
local tweenservice = services.TweenService
local textservice = services.TextService
local coregui = services.CoreGui
local mouse = players.LocalPlayer:GetMouse()

library.flags = {}
library.items = {}
library.theme = {
    fontsize = 17,
    titlesize = 18,
    font = Enum.Font.Code,
    background = "rbxassetid://0",
    tilesize = 90,
    cursor = false,
    cursorimg = "https://t0.rbxcdn.com/42f66da98c40252ee151326a82aab51f",
    backgroundcolor = Color3.fromRGB(20, 20, 20),
    tabstextcolor = Color3.fromRGB(207, 207, 207),
    bordercolor = Color3.fromRGB(75, 207, 255),
    accentcolor = Color3.fromRGB(207, 207, 207),
    accentcolor2 = Color3.fromRGB(108, 108, 108),
    outlinecolor = Color3.fromRGB(20, 20, 20),
    outlinecolor2 = Color3.fromRGB(30, 30, 30),
    sectorcolor = Color3.fromRGB(30, 30, 30),
    toptextcolor = Color3.fromRGB(255, 255, 255),
    topheight = 48,
    topcolor = Color3.fromRGB(30, 30, 30),
    topcolor2 = Color3.fromRGB(12, 12, 12),
    buttoncolor = Color3.fromRGB(49, 49, 49),
    buttoncolor2 = Color3.fromRGB(29, 29, 29),
    itemscolor = Color3.fromRGB(170, 170, 170),
    itemscolor2 = Color3.fromRGB(255, 255, 255)
}

function library:CreateWindow(name, size, hidebutton)
    local window = {
        name = name or "",
        size = UDim2.fromOffset(size.X, size.Y) or UDim2.fromOffset(500, 600),
        hidebutton = hidebutton or Enum.KeyCode.RightShift,
        theme = self.theme,
        tabs = {}
    }

    window.gui = Instance.new("ScreenGui", coregui)
    window.gui.Name = "LibraryGui"
    window.gui.DisplayOrder = 15
    
    local mainFrame = Instance.new("Frame", window.gui)
    mainFrame.Size = window.size
    mainFrame.Position = UDim2.fromScale(0.5, 0.5)
    mainFrame.BackgroundColor3 = window.theme.backgroundcolor
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    
    local topBar = Instance.new("Frame", mainFrame)
    topBar.Size = UDim2.fromOffset(window.size.X.Offset, window.theme.topheight)
    topBar.BackgroundColor3 = window.theme.topcolor
    
    local titleLabel = Instance.new("TextLabel", topBar)
    titleLabel.Text = window.name
    titleLabel.TextSize = window.theme.titlesize
    titleLabel.TextColor3 = window.theme.toptextcolor
    titleLabel.Font = window.theme.font
    titleLabel.BackgroundTransparency = 1
    
    userinputservice.InputBegan:Connect(function(key)
        if key.KeyCode == window.hidebutton then
            mainFrame.Visible = not mainFrame.Visible
        end
    end)
    
    function window:CreateTab(name)
        local tab = {
            name = name,
            sections = {}
        }
        table.insert(self.tabs, tab)
        return tab
    end
    
    return window
end

return library
